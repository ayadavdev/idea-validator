<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Thank you for choosing Nuosoft Kickstart. Your payment has been confirmed and we're excited to help validate your business idea.">
    <meta name="keywords" content="payment confirmation, Nuosoft Kickstart, order confirmation">
    <meta name="author" content="Nuosoft">
    
    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="Permissions-Policy" content="interest-cohort=()">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Payment Confirmed - Nuosoort Kickstart">
    <meta property="og:description" content="Thank you for choosing Nuosoft Kickstart. Your payment has been confirmed.">
    <meta property="og:type" content="website">
    
    <title>Thank You! | Nuosoft Kickstart</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Main content wrapper with semantic structure and ARIA -->
    <main role="main" class="min-h-screen flex flex-col items-center justify-center bg-gray-50 px-4">
        <div class="max-w-md w-full text-center" role="alert" aria-labelledby="confirmation-heading">
            <!-- Success Icon with proper accessibility -->
            <svg class="mx-auto h-12 w-12 text-green-500" 
                 xmlns="http://www.w3.org/2000/svg" 
                 fill="none" 
                 viewBox="0 0 24 24" 
                 stroke-width="1.5" 
                 stroke="currentColor"
                 aria-hidden="true"
                 role="img">
                <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            
            <h1 id="confirmation-heading" class="mt-4 text-3xl font-bold tracking-tight text-gray-900 sm:text-4xl">Payment Successful!</h1>
            <p class="mt-4 text-lg leading-7 text-gray-600">Thank you for your order! The next step is to fill out your project brief. You can get started right away using the button below.</p>
            
            <div class="mt-8">
                <a href="https://tally.so/r/nGZoOz" class="inline-block rounded-md bg-indigo-600 px-4 py-3 text-base font-semibold text-white shadow-sm hover:bg-indigo-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-indigo-600">Start Your Project Brief</a>
            </div>

            <div class="mt-8 border-t border-gray-200 pt-6">
                <p class="text-sm text-gray-500">For your records, a welcome email with the same link to <a href="https://tally.so/r/nGZoOz" class="font-medium text-indigo-600 hover:text-indigo-500">'Start Your Project Brief'</a> is on its way to your inbox.</p>
                <p class="mt-2 text-sm text-gray-500">A payment to NUOSOFT KICKSTART will appear on your statement.</p>
            </div>
            
            <!-- Navigation with proper accessibility -->
            <nav class="mt-10" role="navigation">
                <a href="https://www.nuosoft.com" 
                   class="text-sm font-semibold leading-6 text-gray-600 hover:text-gray-500"
                   aria-label="Return to Nuosoft homepage">
                    &larr; Return to Nuosoft.com
                </a>
            </nav>
        </div>
    </main>

    <script>
        // Self-executing function to protect the page and pass the Stripe Session ID.
        (function() {
            // Part 1: Security - Check if the user was referred from Stripe.
            try {
                if (!document.referrer) {
                    window.location.replace('https://www.nuosoft.com');
                    return;
                }
                
                const referrerUrl = new URL(document.referrer);
                const hostname = referrerUrl.hostname;

                if (hostname !== 'stripe.com' && !hostname.endsWith('.stripe.com')) {
                    window.location.replace('https://www.nuosoft.com');
                }
            } catch (e) {
                console.error("Referrer check failed:", e);
                window.location.replace('https://www.nuosoft.com');
            }

            // Part 2: Data Passthrough - Get the session ID and add it to the Tally links.
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const sessionId = urlParams.get('stripe_session_id');

                if (sessionId) {
                    const tallyLinks = document.querySelectorAll('a[href*="tally.so/r/nGZoOz"]');
                    
                    tallyLinks.forEach(link => {
                        const originalUrl = link.href.split('?')[0]; // Get URL without existing params
                        link.href = `${originalUrl}?stripe_session_id=${encodeURIComponent(sessionId)}`;
                    });
                }
            } catch (e) {
                console.error("Failed to process Stripe session ID:", e);
                // We don't redirect here as the core page function is still valid.
            }
        })();
    </script>

</body>
</html>

